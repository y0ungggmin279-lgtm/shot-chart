<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë†êµ¬ ìŠ›ì°¨íŠ¸ ìƒì„±ê¸°</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f4f4; }
        h1 { text-align: center; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-group { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .input-group label { flex: 2; font-weight: bold; }
        .input-wrapper { flex: 1; display: flex; gap: 5px; align-items: center; }
        input[type="number"] { width: 50px; padding: 5px; text-align: center; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { display: block; width: 100%; padding: 15px; background-color: #ff6b00; color: white; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 20px; border-radius: 5px; }
        .btn:hover { background-color: #e65c00; }
        
        /* ìº”ë²„ìŠ¤ (ìŠ›ì°¨íŠ¸) */
        #chart-container { position: relative; width: 100%; margin-top: 30px; text-align: center; }
        canvas { background-color: #fff; border: 2px solid #333; max-width: 100%; }
        
        /* ê²°ê³¼ í…Œì´ë¸” */
        .stats-table { width: 100%; margin-top: 20px; border-collapse: collapse; text-align: center; }
        .stats-table th, .stats-table td { border: 1px solid #ddd; padding: 8px; }
        .stats-table th { background-color: #333; color: white; }
        
        .loading { display: none; text-align: center; color: blue; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ€ ë†êµ¬ ìŠ›ì°¨íŠ¸ ì…ë ¥</h1>
    
    <div id="input-forms">
        </div>

    <button class="btn" onclick="generateChartAndSave()">ìŠ› ì°¨íŠ¸ ë§Œë“¤ê¸° & ì €ì¥</button>
    <div id="loading" class="loading">ë°ì´í„° ì €ì¥ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>

    <div id="result-area" style="display:none;">
        <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
        
        <table class="stats-table">
            <thead>
                <tr>
                    <th>FG% (ì•¼íˆ¬ìœ¨)</th>
                    <th>3P% (3ì ìŠ›)</th>
                    <th>eFG% (íš¨ìœ¨ì„±)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="res-fg">0%</td>
                    <td id="res-3p">0%</td>
                    <td id="res-efg">0%</td>
                </tr>
            </tbody>
        </table>

        <div id="chart-container">
            <canvas id="shotChart" width="500" height="470"></canvas>
            <p><small>* ì´ˆë¡: ë¦¬ê·¸ ëŒ€ë¹„ +10% ì´ìƒ | ë…¸ë‘: ë¹„ìŠ· | ë¹¨ê°•: -10% ì´í•˜</small></p>
        </div>
    </div>
</div>

<script>
    // ---------------------------------------------------------
    // 1. ì„¤ì •: êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URL (ë°°í¬ í›„ ì—¬ê¸°ì— ë³µì‚¬í•´ë„£ìœ¼ì„¸ìš”)
    // ---------------------------------------------------------
    const SCRIPT_URL = "ì—¬ê¸°ì—_êµ¬ê¸€_ì›¹ì•±_URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"; 

    // ---------------------------------------------------------
    // 2. ë°ì´í„° ì •ì˜ (êµ¬ì—­ ì •ë³´ ë° NBA í‰ê·  ì˜ˆì‹œ)
    // ì¢Œí‘œ(x,y)ëŠ” 500x470 ìº”ë²„ìŠ¤ ê¸°ì¤€ (ê³¨ëŒ€ëŠ” ëŒ€ëµ x=250, y=415)
    // ---------------------------------------------------------
    const ZONES = [
        { key: "ra", name: "ì œí•œêµ¬ì—­ (Restricted)", nba: 65, x: 250, y: 420, is3p: false },
        { key: "paint_l", name: "ì¢Œì¸¡ í˜ì¸íŠ¸", nba: 42, x: 170, y: 400, is3p: false },
        { key: "paint_c", name: "ì¤‘ì•™ í˜ì¸íŠ¸", nba: 42, x: 250, y: 350, is3p: false },
        { key: "paint_r", name: "ìš°ì¸¡ í˜ì¸íŠ¸", nba: 42, x: 330, y: 400, is3p: false },
        { key: "short_l", name: "ì¢Œì¸¡ ìˆ ì½”ë„ˆ", nba: 40, x: 80, y: 400, is3p: false },
        { key: "short_r", name: "ìš°ì¸¡ ìˆ ì½”ë„ˆ", nba: 40, x: 420, y: 400, is3p: false },
        { key: "mid_l", name: "ì¢Œì¸¡ ë¯¸ë“œë ˆì¸ì§€", nba: 40, x: 100, y: 280, is3p: false },
        { key: "mid_c", name: "ì¤‘ì•™ ë¯¸ë“œë ˆì¸ì§€", nba: 40, x: 250, y: 250, is3p: false },
        { key: "mid_r", name: "ìš°ì¸¡ ë¯¸ë“œë ˆì¸ì§€", nba: 40, x: 400, y: 280, is3p: false },
        { key: "c3_l", name: "ì¢Œì¸¡ ì½”ë„ˆ 3ì ", nba: 38, x: 30, y: 420, is3p: true },
        { key: "c3_r", name: "ìš°ì¸¡ ì½”ë„ˆ 3ì ", nba: 38, x: 470, y: 420, is3p: true },
        { key: "w3_l", name: "ì¢Œì¸¡ ìœ™ 3ì ", nba: 36, x: 70, y: 150, is3p: true },
        { key: "top3", name: "ì¤‘ì•™ 3ì ", nba: 35, x: 250, y: 100, is3p: true },
        { key: "w3_r", name: "ìš°ì¸¡ ìœ™ 3ì ", nba: 36, x: 430, y: 150, is3p: true }
    ];

    // ---------------------------------------------------------
    // 3. ì´ˆê¸°í™”: ì…ë ¥ í¼ ìƒì„±
    // ---------------------------------------------------------
    const formContainer = document.getElementById("input-forms");
    ZONES.forEach(zone => {
        const div = document.createElement("div");
        div.className = "input-group";
        div.innerHTML = `
            <label>${zone.name}</label>
            <div class="input-wrapper">
                ì„±ê³µ: <input type="number" id="${zone.key}_m" value="0" min="0">
                ì‹œë„: <input type="number" id="${zone.key}_a" value="0" min="0">
            </div>
        `;
        formContainer.appendChild(div);
    });

    // ---------------------------------------------------------
    // 4. ë©”ì¸ ë¡œì§: ì°¨íŠ¸ ìƒì„± ë° ì €ì¥
    // ---------------------------------------------------------
    function generateChartAndSave() {
        const resultArea = document.getElementById("result-area");
        const loading = document.getElementById("loading");
        
        // 1. ë°ì´í„° ìˆ˜ì§‘ ë° ê³„ì‚°
        let totalM = 0, totalA = 0;
        let total3M = 0, total3A = 0;
        let payload = {}; // êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë³´ë‚¼ ë°ì´í„° ê°ì²´

        ZONES.forEach(z => {
            const m = parseInt(document.getElementById(z.key + "_m").value) || 0;
            const a = parseInt(document.getElementById(z.key + "_a").value) || 0;
            
            totalM += m;
            totalA += a;
            if(z.is3p) { total3M += m; total3A += a; }

            // payloadì— êµ¬ì—­ë³„ ë°ì´í„° ì €ì¥
            payload[z.key + "_m"] = m;
            payload[z.key + "_a"] = a;
            
            // ì‹œê°í™”ìš© ë°ì´í„° ì„ì‹œ ì €ì¥
            z.userM = m;
            z.userA = a;
            z.userPct = a > 0 ? (m / a) * 100 : 0;
        });

        const fgPct = totalA > 0 ? (totalM / totalA) * 100 : 0;
        const p3Pct = total3A > 0 ? (total3M / total3A) * 100 : 0;
        const efgPct = totalA > 0 ? ((totalM + 0.5 * total3M) / totalA) * 100 : 0;

        // payloadì— ì¢…í•© ë°ì´í„° ì¶”ê°€
        payload.total_fgm = totalM;
        payload.total_fga = totalA;
        payload.total_fg_pct = fgPct.toFixed(1) + "%";
        payload.total_3pm = total3M;
        payload.total_3pa = total3A;
        payload.efg_pct = efgPct.toFixed(1) + "%";

        // 2. ê²°ê³¼ í™”ë©´ í‘œì‹œ
        document.getElementById("res-fg").innerText = `${totalM}/${totalA} (${fgPct.toFixed(1)}%)`;
        document.getElementById("res-3p").innerText = `${total3M}/${total3A} (${p3Pct.toFixed(1)}%)`;
        document.getElementById("res-efg").innerText = `${efgPct.toFixed(1)}%`;
        
        resultArea.style.display = "block";
        
        // 3. ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        drawShotChart();

        // 4. êµ¬ê¸€ ì‹œíŠ¸ë¡œ ì „ì†¡ (ë¹„ë™ê¸°)
        if(SCRIPT_URL.includes("ì›¹ ì•± URL")) {
            alert("ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ë‚´ SCRIPT_URL ë³€ìˆ˜ì— êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ URLì„ ë„£ì–´ì£¼ì„¸ìš”!");
            return;
        }

        loading.style.display = "block";
        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", // êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ CORS ì •ì±…ìƒ no-cors ì‚¬ìš© (ì‘ë‹µ ë‚´ìš© í™•ì¸ ë¶ˆê°€í•˜ì§€ë§Œ ì „ì†¡ì€ ë¨)
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        }).then(() => {
            loading.style.display = "none";
            alert("ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }).catch(err => {
            loading.style.display = "none";
            alert("ì €ì¥ ì‹¤íŒ¨: " + err);
        });
    }

    // ---------------------------------------------------------
    // 5. ìº”ë²„ìŠ¤ ë“œë¡œì‰ ë¡œì§ (ì½”íŠ¸ ë° ìŠ› ë°ì´í„°)
    // ---------------------------------------------------------
    function drawShotChart() {
        const canvas = document.getElementById("shotChart");
        const ctx = canvas.getContext("2d");
        
        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // (A) ë†êµ¬ ì½”íŠ¸ ê·¸ë¦¬ê¸° (ë°˜ ì½”íŠ¸)
        drawCourt(ctx);

        // (B) ìŠ› ë°ì´í„° ê·¸ë¦¬ê¸°
        ZONES.forEach(z => {
            // ì‹œë„ê°€ ì—†ìœ¼ë©´ ê·¸ë¦¬ì§€ ì•ŠìŒ
            if(z.userA === 0) return;

            // ìƒ‰ìƒ ê²°ì • ë¡œì§ (+10% ì´ˆë¡, -10% ë¹¨ê°•, ê·¸ ì™¸ ë…¸ë‘)
            let color = "#f1c40f"; // Yellow
            if (z.userPct >= z.nba + 10) color = "#2ecc71"; // Green
            else if (z.userPct <= z.nba - 10) color = "#e74c3c"; // Red

            // ì› ê·¸ë¦¬ê¸° (êµ¬ì—­ ìœ„ì¹˜)
            ctx.beginPath();
            ctx.arc(z.x, z.y, 25, 0, 2 * Math.PI); // ë°˜ì§€ë¦„ 25
            ctx.fillStyle = color;
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = "#333";
            ctx.stroke();

            // í…ìŠ¤íŠ¸ (ì„±ê³µ/ì‹œë„)
            ctx.fillStyle = "#000";
            ctx.font = "bold 12px Arial";
            ctx.textAlign = "center";
            ctx.fillText(`${z.userM}/${z.userA}`, z.x, z.y - 3);
            ctx.fillText(`${Math.round(z.userPct)}%`, z.x, z.y + 10);
        });
    }

    function drawCourt(ctx) {
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#555";

        // 3ì  ë¼ì¸ (ë‹¨ìˆœí™”ëœ ì•„ì¹˜)
        ctx.beginPath();
        ctx.moveTo(30, 470); // ì™¼ìª½ ì½”ë„ˆ
        ctx.lineTo(30, 330);
        ctx.bezierCurveTo(30, 100, 470, 100, 470, 330); // ì•„ì¹˜
        ctx.lineTo(470, 470); // ì˜¤ë¥¸ìª½ ì½”ë„ˆ
        ctx.stroke();

        // í˜ì¸íŠ¸ì¡´ (Key)
        ctx.strokeRect(170, 280, 160, 190);

        // ì œí•œêµ¬ì—­ (ê³¨ëŒ€ ë°‘)
        ctx.beginPath();
        ctx.arc(250, 415, 30, Math.PI, 0); 
        ctx.stroke();

        // ê³¨ëŒ€ (Rim)
        ctx.beginPath();
        ctx.arc(250, 415, 6, 0, 2 * Math.PI);
        ctx.strokeStyle = "orange";
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // ë°±ë³´ë“œ
        ctx.beginPath();
        ctx.moveTo(220, 425);
        ctx.lineTo(280, 425);
        ctx.strokeStyle = "#555";
        ctx.lineWidth = 2;
        ctx.stroke();
    }
</script>

</body>
</html>
